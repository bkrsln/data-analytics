SELECT 
    COUNT(DISTINCT A11.MSISDN) AS RESULT
FROM
    SERVICE_SUBSCRIPTION A11,
    OFFER A12,
    DAILY_CALENDAR A13
WHERE 1=1
    AND A11.CATALOG_OFFER_ID = A12.OFFER_ID 
    AND (CASE WHEN TO_CHAR(A11.START_DATE,'YYYYMMDD') >= 20230101 AND A12.OFFER_NK IN ('602960230','604065316') THEN 1
              WHEN A12.OFFER_NK IN (REPORTER.DSS_KPI_OFFERS) AND A12.OFFER_NK NOT IN ('602960230','604065316') THEN 1
              ELSE 0 END) = 1
    AND A13.DAILY_CALENDAR_ID = TO_CHAR(LAST_DAY(ADD_MONTHS(SYSDATE-1,-1)),'YYYYMMDD')
    AND TO_CHAR(A11.START_DATE,'YYYYMMDD') <= A13.DAILY_CALENDAR_ID
    AND TO_CHAR(A11.END_DATE,'YYYYMMDD') > A13.DAILY_CALENDAR_ID